# vanilla-beans спецификация

> Этот документ разъясняет понятия и сущности.

## Назначение библиотеки
**vanilla-beans** предназначена для разработки пользовательских интерфейсов любой сложности и динамичности. Предоставляет возможность создания собственных компонентов - **beans** и объединения их в сложные композиты, непосредственно используя возможности HTML, Javascript и DOM API.

## Краткое описание
**vanilla-beans** - это тонкая надстройка над HTML и DOM API, не создаэт своего собственного окружения, не диктует правила и не изолирует Вас от возможностей WEB платформы. Всё, что можно делать с HTML и Javascript, можно делать с компонентами **vanilla-beans**. Декларация компонента использует HTML для описания структуры компонента и Javascript для описания его поведения наиболее очевидным образом.

Экстремально лёгкая и быстрая.  
Крайне проста в освоении, достаточно знания основ HTML, Javascript и DOM API.  
Идеальна для обучения.

Библиотека и идеи, лежащие в её основе настолько просты и очевидны, что даже не понятно, почему никто не реализовал что-то подобное раньше.

**vanilla-beans, не является альтернативой Web Components, прекрасно с ними совмещается в обе стороны.**

## Термины и определения

### Bean
Композитный компонент, - основной строительный блок для построения пользовательского интерфейса, имеет своё дерево DOM, поведение и жизненный цикл. Может составляться из стандартных элементов, Custom Elements и других бинов.

### Bean declaration
Декларация бина - HTML разметка и (опционально) скрипт инициализации, описывающий поведение и обработчики событий жизненного цикла.  
Минимальая декларация бина на базе элемента DIV:

```html
<div beans-as="my-bean">

</div>

```
Парсинг декларации осуществляется штатными средствами браузера. HTML комментарии игнрируются при парсинге.

### BeanDescriptor
Дескриптор бина - внутреннее представление бина в репозитории, создаётся библиотекой из декларации бина.

### Bean instance
Экземпляр бина, - DOM Node с подмешанными методами и обработчиками событий жизненного цикла, не содержит специфичных **beans-ххх** атрибутов. Создаётся библиотекой из BeanDescriptor

### BeansLibrary declaration
Текстовый файл или строка с набором деклараций бинов и импортом других BeansLibrary (аналогично модулям ESM), так-же может импортировать модули CommonJs (без зависимостей) и CSS файлы.

### BeansLibrary
Набор BeanDescriptor's в репозитории, создаётся бибиотекой из BeansLibrary declaration.

### Factory
Фабрика, связанная с конкретной BeansLibrary готовая к инициализации контекстом приложения.

### FactoryInitiated
Фабрика, инициированная контекстом приложения.

### Application
Приложение, в котором используются бины. Объединяется через **Application context**

### Application context
Произвольный объект, определяемый разработчиком приложения, который передаётся во все бины одного приложения через аргумент скрипта инициализации **$context**.

**$context** может содержать, например, ссылку на контроллер приложения, общий диспетчер сообщений, менеджер состояний, набор настроек, всё что полезно - в зависимости от реализуемой архитектуры приложения.

## Состав библиотеки

### Модули
[factory.mjs](../src/factory/factory.mjs) экспортирует по умолчанию фабричный метод **factory**

### Сборки



## Расширение HTML для использования в BeansLibrary declaration

Для исполнения своего назначения библиотека расширяет HTML, вводя специальные тэги и атрибуты для использования в [BeansLibrary declaration](#beanslibrary-declaration)

### Tags
Добавлен только один тэг

#### <a name="BEANS-IMPORT">&lt;BEANS-IMPORT&gt;</a> используется в [BeansLibrary declaration](#beanslibrary-declaration)  для подключения зависимостей. должен располагаться на верхнем уровне декларации. 

```html
--imports
<beans-import type="html" src="./module.html" beans-as="my-module"></beans-import>
<beans-import type="cjs" src="../js/module.js" beans-as="my-script"></beans-import>
<beans-import type="css" src="../css/module.css" beans-as="my-stylesheet"></beans-import>

--beans declarations
.......

```

Настраивается атрибутами 

- **type** - тип подключаемого ресурса, может принимать значения 

    - **html** - для подключения BeansLibrary declaration
    - **cjs** - для подключения модуля CommonJs, модуль не должен иметь зависимостей.
    - **css** - для подключения файла css

    не обязательный, по умолчанию 'html'

- **src** - относительный или абсолютный адрес подключаемого ресурса (URL или имя файла)

    обязательный

- **beans-as** - имя подключаемого ресурса для использования в декларациях бинов и скриптах инициализации

    обязательный, значение должно быть уникальным для тэгов BEANS-IMPORT в пределах [BeansLibrary declaration](#beanslibrary-declaration)

Допускаются рекурсивные зависимости, при обнаружении такой зависимости в консоли будет выведено предупреждение.

### Атрибуты, используемые в [Bean declaration](#bean-declaration)
В декларациях бинов применяются пять дополнительных атрибутов

- **beans-as** - объявляет имя декларируемого бина для использования в других декларациях, располагается в корневом элементе бина

- **beans-tagname** - может применяться в корневом элементе [Bean declaration](#bean-declaration) и в любом элементе внутри [Bean declaration](#bean-declaration), используется для подмены базового тэга, на основе которго создаётся бин, может принимать имя бина, имя станартного или пользовательского элемента, применяется в [BeanDescriptor](#beandescriptor) вместо **element.tagName**

- **beans-usetag** - может применяться так-же как и **beans-tagname**, но не перекрывает имя бина, применяется в момент создания [экземпляра](#bean-instance)

- **beans-ref** - имя ссылки на элемент, для использования в [скрипте инициализации](#init-script)

- **beans-body** - указывает элемент в поддереве бина, в который будут монтироваться ноды извне, в бине может располагаться только один элемент с тэгом **beans-body**

```html
--пример использования beans-tagname
<table beans-as="my-super-table">
    <tbody>
        <!--здесь нельзя использовать "table-row" в имени тэга-->
        <tr beans-tagname="table-row" class="my-class"></tr>
        <tr beans-tagname="table-row" class="my-class"></tr>
    </tbody>
</table>

--пример использования beans-usetag
<div beans-as="table-row" beans-usetag="tr">
    <div beans-usetag="td">1</div>
    <div beans-usetag="td">2</div>
    <div beans-usetag="td">3</div>
    <script>
        //здесь можно что-то сделать с вложенными элементами
    </script>
</div>

--результат создания бина my-super-table
<table>
    <tbody>
        <tr class="my-class">
            <td>1</td>
            <td>2</td>
            <td>3</td>
        </tr>
        <tr class="my-class">
            <td>1</td>
            <td>2</td>
            <td>3</td>
        </tr>
    </tbody>
</table>
```



### Built-in beans



### Init script 





